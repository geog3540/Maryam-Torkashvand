<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Community Detection Maps</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
  .map {
    display: inline-block;
    border: 1px solid black;
  }
  </style>
</head>
<body>
  <svg id="map1" class="map" width="960" height="600"></svg>
  <svg id="map2" class="map" width="960" height="600"></svg>
  <script>
  // Jaccard similarity function
  function jaccardSimilarity(set1, set2) {
    const intersection = set1.filter(value => set2.includes(value)).length;
    const union = new Set([...set1, ...set2]).size;
    return union === 0 ? 0 : intersection / union;
  }

  // Function to draw the map
  function drawMap(svgId, geoJsonData, partitionAttribute1, partitionAttribute2, colorScale) {
    var path = d3.geoPath();
    var svg = d3.select("#" + svgId)
      .attr("width", 960)
      .attr("height", 600);

    svg.append("g")
      .selectAll("path")
      .data(geoJsonData.features)
      .join("path")
      .attr("d", path)
      .attr("fill", function(d) {
        const community1 = d.properties[partitionAttribute1];
        const community2 = d.properties[partitionAttribute2];

        const similarity = jaccardSimilarity(community1, community2);

        if (similarity >= 0.5) {
          return colorScale(community1);
        } else {
          return "gray";
        }
      })
      .attr("stroke", "white")
      .attr("stroke-width", 1);
  }

  // Load the first GeoJSON file
  // Load the first GeoJSON file
var polygonJSONFile1 = "data/louvain.geojson";
d3.json(polygonJSONFile1, function (error, community1) {
  if (error) throw error;

  // Load the second GeoJSON file
  var polygonJSONFile2 = "data/leiden.geojson";
  d3.json(polygonJSONFile2, function (error, community2) {
    if (error) throw error;

    // Create a color scale based on the partitions
    const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

    // Calculate Jaccard similarity
    // Calculate Jaccard similarity
    function calculateJaccardSimilarity(set1, set2) {
      const intersection = set1.filter(x => set2.includes(x)).length;
      const union = new Set([...set1, ...set2]).size;

      return intersection / union;
    }

    // Calculate the Jaccard similarity
    const jaccardSimilarity = calculateJaccardSimilarity(partitions1, partitions2);
    console.log("Jaccard similarity:", jaccardSimilarity);

    const community1partitions = community1.features.map(feature => feature.properties.leidenpart);
    const community2partitions = community2.features.map(feature => feature.properties.louvainpar);

    const similarity = jaccardSimilarity(community1partitions, community2partitions);
    console.log("Jaccard similarity:", similarity);

    // Draw the maps
    drawMap("map1", community1, "leidenpart", "louvainpar", colorScale);
    drawMap("map2", community2, "leidenpart", "louvainpar", colorScale);
  });
});

  </script>
</body>
</html>
