<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>migrationstructures</title>

  <script src="https://d3js.org/d3.v6.min.js"></script>

  <!--Basic Style and Layout-->
  <style>
  body{
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
  }

  /* Header and Navigation */
  .header h1 {
    color: #fff;
    margin: 0;
    font-size: 1.5rem;
  }

  .nav li {
    display: inline-block;
    margin-left: 1rem;
  }

  .nav a{
    color: #fff;
    text-decoration: none;
  }

  .description{
    display: flex;
    justify-content: center;
    align-item: center;
    gap: 1rem;
  }

  .map {
    display: inline-block;
    border: 1px solid black;
  }

  .footer{
    background-color: #14365D;
    color: #fff;
    padding: 1rem;
    text-align: center;
    margin-top: 1rem;
  }
  </style>

</head>
<body>

  <div class= "header">
    <h1>Migration Structures in the United States (1910-1920)</h1>
    <u1 class= "nav">
      <li><a href="../index.html">Portfolio</a></li>
    </u>
  </div>

  <!-- Description -->
  <div class= "description">
    <p>Mapping migration regions using two network community detection algorithms. The visualization method employed ensures consistency by maintaining the same color for each region across both maps, allowing for easier comparison and interpretation.</p>
  </div>

  <!-- Maps -->
  <svg id="map1" class="map" width="960" height="600"></svg>
  <svg id="map2" class="map" width="960" height="600"></svg>

  <script>

  //////////////////////////////////////////////////////////////////////////////
  //Paircounting function: first check the size of both netwoeks be same

    function pairCountingSimilarity(communities1, communities2) {
      if (communities1.length !== communities2.length) {
        throw new Error("Input arrays must have the same length");
      }

      //initialize the variables
      let matches = 0;
      let totalPairs = 0;

      //define the unique pairs of nodes (0,1),(0,2), ... (n-1,n)
      for (let i = 0; i < communities1.length; i++) {
        for (let j = i + 1; j < communities1.length; j++) {
          totalPairs++;

          //chech whether those pairs that are in a same community in network 1 also are the same community in network 2
          //if true, add 1 to the match variable
          if (communities1[i] === communities1[j] && communities2[i] === communities2[j]) {
            matches++;
          }
        }
      }
      //Deviding the number of matches by total number of pairs to find the degree of similarity
      return matches / totalPairs;
    }

    /////////////////////////////////////////////////////////////////////////////
    //Defining Maps
    var projection = d3.geoAlbersUsa();
    var path = d3.geoPath().projection(projection);
    var colorScale = d3.scaleOrdinal(d3.schemeCategory10);

    d3.json("data/louvain.geojson").then(function(geoJsonData1) {
      d3.json("data/leiden.geojson").then(function(geoJsonData2) {
        const partitions1 = geoJsonData1.features.map(feature => feature.properties.leidenpart);
        const partitions2 = geoJsonData2.features.map(feature => feature.properties.louvainpar);

        const similarity = pairCountingSimilarity(partitions1, partitions2);
        console.log("Pair counting similarity:", similarity);

        //Drawing maps
        var svg1 = d3.select("#map1");
        svg1.selectAll("path")
          .data(geoJsonData1.features)
          .join("path")
          .attr("d", path)
          .attr("fill", function(d) {
            return colorScale(d.properties.leidenpart);
          })
          .attr("stroke", "white")
          .attr("stroke-width", 1);

        var svg2 = d3.select("#map2");
        svg2.selectAll("path")
          .data(geoJsonData2.features)
          .join("path")
          .attr("d", path)
          .attr("fill", function(d) {
            return colorScale(d.properties.louvainpar);
          })
          .attr("stroke", "white")
          .attr("stroke-width", 1);
      });
    });
  </script>
</body>
</html>
