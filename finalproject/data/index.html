<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Community Detection Maps</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
  .map {
    display: inline-block;
    border: 1px solid black;
  }
  </style>
</head>
<body>
  <svg id="map1" class="map" width="960" height="600"></svg>
  <svg id="map2" class="map" width="960" height="600"></svg>
  <script>
  // Pair counting similarity function
  function pairCountingSimilarity(communities1, communities2) {
    if (communities1.length !== communities2.length) {
      throw new Error("Input arrays must have the same length");
    }

    let matches = 0;
    let totalPairs = 0;

    for (let i = 0; i < communities1.length; i++) {
      for (let j = i + 1; j < communities1.length; j++) {
        totalPairs++;

        if (communities1[i] === communities1[j] && communities2[i] === communities2[j]) {
          matches++;
        }
      }
    }

    return matches / totalPairs;
  }

  // Function to draw the map
  function drawMap(svgId, geoJsonData, partitionAttribute, colorScale) {
    // Create a path generator with a default projection
    var projection = d3.geoAlbersUsa();
    var path = d3.geoPath().projection(projection);

    // Select the SVG element and set its size
    var svg = d3.select("#" + svgId)
    .attr("width", 960)
    .attr("height", 600);

    // Draw the map
    svg.append("g")
    .selectAll("path")
    .data(geoJsonData.features)
    .join("path")
    .attr("d", path)
    .attr("fill", function(d) {
      return colorScale(d.properties[partitionAttribute]);
    })
    .attr("stroke", "white")
    .attr("stroke-width", 1);
  }

  // Load the first GeoJSON file
  var polygonJSONFile1 = "data/louvain.geojson";
  d3.json(polygonJSONFile1, function (error, community1) {
    if (error) throw error;

    // Load the second GeoJSON file
    var polygonJSONFile2 = "data/leiden.geojson";
    d3.json(polygonJSONFile2, function (error, community2) {
      if (error) throw error;

      // Extract partition information from GeoJSON files
      const partitions1 = community1.features.map(feature => feature.properties.leidenpart);
      const partitions2 = community2.features.map(feature => feature.properties.louvainpar);

      // Calculate the pair counting similarity
      const similarity = pairCountingSimilarity(partitions1, partitions2);

      // Create a color scale based on the partitions
      const colorScale = d3.scaleOrdinal(d3.schemeCategory10);

      /// Draw the maps
      drawMap("map1", community1, "leidenpart", colorScale);
      drawMap("map2", community2, "louvainpar", colorScale);


      console.log("Pair counting similarity:", similarity);
    });
  });
  </script>
</body>
</html>
